{% extends 'home/base.html' %}
{% load static %}

{% block title %}Submit a Review - FreshMart{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="review-section">
        <h2>Submit a Review</h2>
        
        <div class="review-content">
            <!-- Review Form -->
            <div class="review-form-container">
                <h3>Share Your Experience</h3>
                
                {% if messages %}
                <div class="messages">
                    {% for message in messages %}
                    <div class="alert alert-success">{{ message }}</div>
                    {% endfor %}
                </div>
                {% endif %}
                
                <form method="post">
                    {% csrf_token %}
                    
                    {% if form.errors %}
                    <div class="alert alert-error">
                        Please correct the errors below.
                    </div>
                    {% endif %}
                    
                    <div class="form-group">
                        <label for="{{ form.name.id_for_label }}">Your Name</label>
                        {{ form.name }}
                        {% if form.name.errors %}
                        <div class="errorlist">{{ form.name.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ form.email.id_for_label }}">Your Email</label>
                        {{ form.email }}
                        {% if form.email.errors %}
                        <div class="errorlist">{{ form.email.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label>Rating</label>
                        <div class="rating-input">
                            {% for choice in form.rating %}
                            {{ choice.tag }}
                            <label for="{{ choice.id_for_label }}">★</label>
                            {% endfor %}
                        </div>
                        {% if form.rating.errors %}
                        <div class="errorlist">{{ form.rating.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ form.title.id_for_label }}">Review Title</label>
                        {{ form.title }}
                        {% if form.title.errors %}
                        <div class="errorlist">{{ form.title.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ form.comment.id_for_label }}">Your Review</label>
                        {{ form.comment }}
                        {% if form.comment.errors %}
                        <div class="errorlist">{{ form.comment.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <button type="submit" class="submit-btn">Submit Review</button>
                    <a href="{% url 'home:index' %}" class="btn btn-secondary" style="margin-top: 10px; display: inline-block; text-align: center;">Cancel</a>
                </form>
            </div>
            
            <!-- Recent Approved Reviews Display -->
            <div class="reviews-container">
                <h3>What Our Customers Say</h3>
                
                <div class="reviews-stats">
                    <div class="stat-item">
                        <div class="stat-value">{{ average_rating|default:"0.0" }}</div>
                        <div class="stat-label">Average Rating</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">{{ total_reviews|default:"0" }}</div>
                        <div class="stat-label">Approved Reviews</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">{{ positive_percentage|default:"0" }}%</div>
                        <div class="stat-label">Positive Reviews</div>
                    </div>
                </div>
                
                <div class="reviews-list">
                    {% if reviews %}
                        {% for review in reviews %}
                        <div class="review-card">
                            <div class="review-header">
                                <div class="reviewer-name">{{ review.name }}</div>
                                <div class="review-date">{{ review.created_at|date:"M d, Y" }}</div>
                            </div>
                            <div class="review-rating">
                                <span class="stars">
                                    {% for i in "12345" %}
                                        {% if forloop.counter <= review.rating %}★{% else %}☆{% endif %}
                                    {% endfor %}
                                </span> ({{ review.rating }}/5)
                            </div>
                            <div class="review-title">{{ review.title }}</div>
                            <div class="review-content-text">{{ review.comment }}</div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="no-reviews">No approved reviews yet. Be the first to leave a review!</div>
                    {% endif %}
                </div>
                
                <div style="text-align: center; margin-top: 1rem;">
                    <a href="{% url 'reviews:review_list' %}" class="btn btn-primary">View All Reviews</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}